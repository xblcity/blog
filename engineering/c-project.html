<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>C端Next.js项目踩坑 | Blog</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/blog/avatar.png">
    <meta name="description" content="小白龙的前端记录">
    
    <link rel="preload" href="/blog/assets/css/0.styles.2759c791.css" as="style"><link rel="preload" href="/blog/assets/js/app.ca54a27b.js" as="script"><link rel="preload" href="/blog/assets/js/2.16787ae8.js" as="script"><link rel="preload" href="/blog/assets/js/49.56b4130b.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.a869079e.js"><link rel="prefetch" href="/blog/assets/js/11.47aba66d.js"><link rel="prefetch" href="/blog/assets/js/12.b2f745c4.js"><link rel="prefetch" href="/blog/assets/js/13.ad8e64be.js"><link rel="prefetch" href="/blog/assets/js/14.19ca1486.js"><link rel="prefetch" href="/blog/assets/js/15.ac5a75b4.js"><link rel="prefetch" href="/blog/assets/js/16.4d3ec439.js"><link rel="prefetch" href="/blog/assets/js/17.4ea1a3ce.js"><link rel="prefetch" href="/blog/assets/js/18.939388da.js"><link rel="prefetch" href="/blog/assets/js/19.6c0ce5fc.js"><link rel="prefetch" href="/blog/assets/js/20.08005603.js"><link rel="prefetch" href="/blog/assets/js/21.44153a61.js"><link rel="prefetch" href="/blog/assets/js/22.034e1f3d.js"><link rel="prefetch" href="/blog/assets/js/23.b7313ad1.js"><link rel="prefetch" href="/blog/assets/js/24.7a561252.js"><link rel="prefetch" href="/blog/assets/js/25.d514c6a3.js"><link rel="prefetch" href="/blog/assets/js/26.0598d777.js"><link rel="prefetch" href="/blog/assets/js/27.3c2daeb6.js"><link rel="prefetch" href="/blog/assets/js/28.abbe705c.js"><link rel="prefetch" href="/blog/assets/js/29.fe0300a3.js"><link rel="prefetch" href="/blog/assets/js/3.120be927.js"><link rel="prefetch" href="/blog/assets/js/30.d7857898.js"><link rel="prefetch" href="/blog/assets/js/31.7e7e8345.js"><link rel="prefetch" href="/blog/assets/js/32.0095b5f6.js"><link rel="prefetch" href="/blog/assets/js/33.c43635e3.js"><link rel="prefetch" href="/blog/assets/js/34.23189405.js"><link rel="prefetch" href="/blog/assets/js/35.32a68e74.js"><link rel="prefetch" href="/blog/assets/js/36.b5522a3b.js"><link rel="prefetch" href="/blog/assets/js/37.521f253a.js"><link rel="prefetch" href="/blog/assets/js/38.d40b50d1.js"><link rel="prefetch" href="/blog/assets/js/39.9866df6a.js"><link rel="prefetch" href="/blog/assets/js/4.6386eb32.js"><link rel="prefetch" href="/blog/assets/js/40.6399e96c.js"><link rel="prefetch" href="/blog/assets/js/41.27f98ed6.js"><link rel="prefetch" href="/blog/assets/js/42.9232dcea.js"><link rel="prefetch" href="/blog/assets/js/43.383a06d4.js"><link rel="prefetch" href="/blog/assets/js/44.bf4ab334.js"><link rel="prefetch" href="/blog/assets/js/45.d39de674.js"><link rel="prefetch" href="/blog/assets/js/46.920f147f.js"><link rel="prefetch" href="/blog/assets/js/47.900f8595.js"><link rel="prefetch" href="/blog/assets/js/48.c3de280b.js"><link rel="prefetch" href="/blog/assets/js/5.c485396b.js"><link rel="prefetch" href="/blog/assets/js/50.2cda305e.js"><link rel="prefetch" href="/blog/assets/js/51.2c00aa8c.js"><link rel="prefetch" href="/blog/assets/js/52.5d78822c.js"><link rel="prefetch" href="/blog/assets/js/53.a53fe95a.js"><link rel="prefetch" href="/blog/assets/js/54.5760ce51.js"><link rel="prefetch" href="/blog/assets/js/55.1c086e49.js"><link rel="prefetch" href="/blog/assets/js/56.161fc0cb.js"><link rel="prefetch" href="/blog/assets/js/57.a7ecb5a5.js"><link rel="prefetch" href="/blog/assets/js/58.91e85750.js"><link rel="prefetch" href="/blog/assets/js/59.367ed326.js"><link rel="prefetch" href="/blog/assets/js/6.b879935f.js"><link rel="prefetch" href="/blog/assets/js/60.2f10a9f8.js"><link rel="prefetch" href="/blog/assets/js/61.de5d0fa6.js"><link rel="prefetch" href="/blog/assets/js/62.587e2766.js"><link rel="prefetch" href="/blog/assets/js/63.7f394d4d.js"><link rel="prefetch" href="/blog/assets/js/64.3c55b83e.js"><link rel="prefetch" href="/blog/assets/js/65.4f73d851.js"><link rel="prefetch" href="/blog/assets/js/66.2edb0511.js"><link rel="prefetch" href="/blog/assets/js/67.deca57c5.js"><link rel="prefetch" href="/blog/assets/js/68.35918e5c.js"><link rel="prefetch" href="/blog/assets/js/69.1d25bf4f.js"><link rel="prefetch" href="/blog/assets/js/7.bde98456.js"><link rel="prefetch" href="/blog/assets/js/70.6685b325.js"><link rel="prefetch" href="/blog/assets/js/71.c476a8fb.js"><link rel="prefetch" href="/blog/assets/js/72.5407e0cc.js"><link rel="prefetch" href="/blog/assets/js/73.5b5f66ab.js"><link rel="prefetch" href="/blog/assets/js/74.5dbe1de3.js"><link rel="prefetch" href="/blog/assets/js/75.05b3ae2a.js"><link rel="prefetch" href="/blog/assets/js/76.6cb0c66a.js"><link rel="prefetch" href="/blog/assets/js/77.5246a44f.js"><link rel="prefetch" href="/blog/assets/js/78.a2e9acd1.js"><link rel="prefetch" href="/blog/assets/js/8.03f4b8fb.js"><link rel="prefetch" href="/blog/assets/js/9.cc85d3f5.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.2759c791.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="/blog/avatar.png" alt="Blog" class="logo"> <span class="site-name can-hide">Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://xblcity.github.io/reading-notes/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  读书笔记
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/xblcity" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://xblcity.github.io/reading-notes/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  读书笔记
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/xblcity" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/blog/" aria-current="page" class="sidebar-link">介绍</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/base/inherit.html" class="sidebar-link">类与继承</a></li><li><a href="/blog/base/copy.html" class="sidebar-link">赋值与深浅拷贝</a></li><li><a href="/blog/base/scope-closures.html" class="sidebar-link">作用域与闭包</a></li><li><a href="/blog/base/this.html" class="sidebar-link">理解this</a></li><li><a href="/blog/base/call.html" class="sidebar-link">call, apply, bind手动实现</a></li><li><a href="/blog/base/eventloop.html" class="sidebar-link">JS 事件队列/循环(Event Loop)</a></li><li><a href="/blog/base/ajax.html" class="sidebar-link">AJAX</a></li><li><a href="/blog/base/throttle.html" class="sidebar-link">理解节流与防抖函数</a></li><li><a href="/blog/base/object-methods.html" class="sidebar-link">Object 构造器及原型上的方法</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端进阶</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/advance/ts.html" class="sidebar-link">开发中常用的 Typescript 技巧</a></li><li><a href="/blog/advance/func-program.html" class="sidebar-link">高阶函数</a></li><li><a href="/blog/advance/design-mode.html" class="sidebar-link">JS 设计模式</a></li><li><a href="/blog/advance/algorithm.html" class="sidebar-link">数据结构与算法</a></li><li><a href="/blog/advance/array.html" class="sidebar-link">数组的数据处理</a></li><li><a href="/blog/advance/lodashSource.html" class="sidebar-link">lodash omit</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>React应用</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/react/performance.html" class="sidebar-link">React 性能优化</a></li><li><a href="/blog/react/lifecycle.html" class="sidebar-link">React 生命周期总结&amp;应用</a></li><li><a href="/blog/react/redux.html" class="sidebar-link">Redux/React-Redux</a></li><li><a href="/blog/react/redux-middleware.html" class="sidebar-link">Redux 中间件</a></li><li><a href="/blog/react/encrypt-images.html" class="sidebar-link">加密图片获取</a></li><li><a href="/blog/react/picker.html" class="sidebar-link">Picker 组件</a></li><li><a href="/blog/react/swiper.html" class="sidebar-link">Swiper插件踩坑</a></li><li><a href="/blog/react/find-house.html" class="sidebar-link">找房筛选条件表单封装</a></li><li><a href="/blog/react/umi3.html" class="sidebar-link">umi3 升级</a></li><li><a href="/blog/react/component-design-mode.html" class="sidebar-link">组件设计模式</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端综合知识</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/system/performance.html" class="sidebar-link">性能优化</a></li><li><a href="/blog/system/render.html" class="sidebar-link">从输入网址到页面渲染经历了什么</a></li><li><a href="/blog/system/http.html" class="sidebar-link">http 知识体系</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>工程化</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/engineering/c-project.html" aria-current="page" class="active sidebar-link">C端Next.js项目踩坑</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/engineering/c-project.html#c端和b端的不同" class="sidebar-link">C端和B端的不同</a></li><li class="sidebar-sub-header"><a href="/blog/engineering/c-project.html#设计稿规范" class="sidebar-link">设计稿规范</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/engineering/c-project.html#约定主题色并定义全局变量" class="sidebar-link">约定主题色并定义全局变量</a></li><li class="sidebar-sub-header"><a href="/blog/engineering/c-project.html#约定并引入指定字体" class="sidebar-link">约定并引入指定字体</a></li><li class="sidebar-sub-header"><a href="/blog/engineering/c-project.html#reset-css" class="sidebar-link">reset.css</a></li><li class="sidebar-sub-header"><a href="/blog/engineering/c-project.html#m端需要自适应字体" class="sidebar-link">M端需要自适应字体</a></li><li class="sidebar-sub-header"><a href="/blog/engineering/c-project.html#定义交互规范-比如按钮以及输入框样式" class="sidebar-link">定义交互规范，比如按钮以及输入框样式</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/engineering/c-project.html#项目构建注意事项" class="sidebar-link">项目构建注意事项</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/engineering/c-project.html#接入-eslint-prettier" class="sidebar-link">接入 eslint/prettier</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/engineering/c-project.html#其他技术栈" class="sidebar-link">其他技术栈</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/engineering/c-project.html#接入极验与风控" class="sidebar-link">接入极验与风控</a></li><li class="sidebar-sub-header"><a href="/blog/engineering/c-project.html#埋点" class="sidebar-link">埋点</a></li><li class="sidebar-sub-header"><a href="/blog/engineering/c-project.html#国际化" class="sidebar-link">国际化</a></li><li class="sidebar-sub-header"><a href="/blog/engineering/c-project.html#swiper插件" class="sidebar-link">Swiper插件</a></li></ul></li></ul></li><li><a href="/blog/engineering/webpack-react.html" class="sidebar-link">使用 webpack 从零配置 React 开发环境及打包优化</a></li><li><a href="/blog/engineering/webpack.html" class="sidebar-link">webpack 配置及优化</a></li><li><a href="/blog/engineering/vs.html" class="sidebar-link">vscode 插件与配置</a></li><li><a href="/blog/engineering/git.html" class="sidebar-link">git 的使用</a></li><li><a href="/blog/engineering/git-account.html" class="sidebar-link">Git 多账号配置</a></li><li><a href="/blog/engineering/private-npm.html" class="sidebar-link">windows 系统搭建私有 npm 仓库</a></li><li><a href="/blog/engineering/workflow.html" class="sidebar-link">前端从切分支到打包上线的流程整理</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>后端</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/backend/file.html" class="sidebar-link">Next.js Node 层上传/接收文件流</a></li><li><a href="/blog/backend/little-points.html" class="sidebar-link">node 知识点</a></li><li><a href="/blog/backend/blog.html" class="sidebar-link">博客的后端实现</a></li><li><a href="/blog/backend/mysql.html" class="sidebar-link">mysql 使用</a></li><li><a href="/blog/backend/server.html" class="sidebar-link">使用服务器</a></li><li><a href="/blog/backend/nginx.html" class="sidebar-link">nginx 在 window 下的配置与使用</a></li><li><a href="/blog/backend/ubuntu.html" class="sidebar-link">ubuntu服务器终端及图形界面连接</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>第三方库</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/library/wx-web.html" class="sidebar-link">微信公众号网页登录与支付</a></li><li><a href="/blog/library/vue-admin.html" class="sidebar-link">vue-element-admin 的使用</a></li><li><a href="/blog/library/vuepress.html" class="sidebar-link">vuepress 一些自定义配置</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="c端next-js项目踩坑"><a href="#c端next-js项目踩坑" class="header-anchor">#</a> C端Next.js项目踩坑</h1> <h2 id="c端和b端的不同"><a href="#c端和b端的不同" class="header-anchor">#</a> C端和B端的不同</h2> <ul><li><code>C端</code> 对样式要求较高，需要注意相关约定</li> <li>框架不同，需选用 <code>SSR</code>组件库</li> <li>引入 SSG SSR</li></ul> <h2 id="设计稿规范"><a href="#设计稿规范" class="header-anchor">#</a> 设计稿规范</h2> <p>需要和 <code>UI</code> 约定主体设计内容宽度。推荐 <code>1200px</code> 可以满足大部分屏幕需要。</p> <h3 id="约定主题色并定义全局变量"><a href="#约定主题色并定义全局变量" class="header-anchor">#</a> 约定主题色并定义全局变量</h3> <p>定义 CSS 全局变量</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">// 定义
html</span> <span class="token punctuation">{</span>
  <span class="token property">--font-color</span><span class="token punctuation">:</span> #000000<span class="token punctuation">;</span>
  <span class="token property">--bg-color</span><span class="token punctuation">:</span> #0000<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">// 入口文件引入全局样式
// 使用
.main</span> <span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--font-color<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="约定并引入指定字体"><a href="#约定并引入指定字体" class="header-anchor">#</a> 约定并引入指定字体</h3> <div class="language-css extra-class"><pre class="language-css"><code><span class="token atrule"><span class="token rule">@font-face</span></span> <span class="token punctuation">{</span>
  <span class="token property">font-family</span><span class="token punctuation">:</span> <span class="token string">'Inter-Semi Bold, Inter'</span><span class="token punctuation">;</span>
  <span class="token property">src</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>../common/font/Inter-SemiBold.ttf<span class="token punctuation">)</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">html</span> <span class="token punctuation">{</span>
  <span class="token property">--semi-bold-font</span><span class="token punctuation">:</span> <span class="token string">'Inter-Semi Bold, Inter'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="reset-css"><a href="#reset-css" class="header-anchor">#</a> reset.css</h3> <p>磨平浏览器样式差异</p> <h3 id="m端需要自适应字体"><a href="#m端需要自适应字体" class="header-anchor">#</a> M端需要自适应字体</h3> <p>通过 <code>postcss-pxtorem</code> 插件，把px转换成rem，同时需要监听 ua resize 根元素 html 的 rem</p> <h3 id="定义交互规范-比如按钮以及输入框样式"><a href="#定义交互规范-比如按钮以及输入框样式" class="header-anchor">#</a> 定义交互规范，比如按钮以及输入框样式</h3> <p>以 input 为例，需要注意 default foucs hover 等状态及样式</p> <p>页面的 loading list-empty 图片占位图等需要提前和 UI 约定一致</p> <h2 id="项目构建注意事项"><a href="#项目构建注意事项" class="header-anchor">#</a> 项目构建注意事项</h2> <p>使用 <code>yarn create next-app --typescript</code> 命令即可初始化一个 <code>Next.js</code> 项目。</p> <p><code>package.json</code> 有几个比较常用的命令</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;next dev&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;next build&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;next start&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>dev</code> 命令在开发时使用，可以实现快速刷新。</p> <p><code>build</code> 用于打包。<code>start</code> 用于启动生产模式的 <code>server</code> 必须在 <code>build</code> 之后才能执行。</p> <p><code>Next.js</code> 不需要过多的配置，可以直接上手开发。可以按需配置一些功能。</p> <h3 id="接入-eslint-prettier"><a href="#接入-eslint-prettier" class="header-anchor">#</a> 接入 eslint/prettier</h3> <p>next.js 默认的规则较少，需要用到的是一些 eslit/styleint/prettier 校验及格式化规则，项目中用的是内部的 npm 包，可以配置开源社区相关流行库</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// .eslintrc.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token keyword">extends</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">'eslint:recommended'</span><span class="token punctuation">,</span>
    <span class="token string">'next'</span><span class="token punctuation">,</span>
    require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'xxx'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// .prettierrc.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'xxx'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// .stylelintrc.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token keyword">extends</span><span class="token operator">:</span> <span class="token punctuation">[</span>require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'xxx'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>可以新建 <code>.vscode/settings.json</code> 添加统一的 <code>VS Code</code> 配置，方便团队统一管理</p> <p>主要配置 autoFormat 以及 format 默认采用的扩展选项</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token string-property property">&quot;eslint.format.enable&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;editor.codeActionsOnSave&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;source.fixAll&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;source.fixAll.eslint&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;source.fixAll.stylelint&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;eslint.validate&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;javascript&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;typescript&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;editor.formatOnSave&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="配置-next-config-js"><a href="#配置-next-config-js" class="header-anchor">#</a> 配置 next.config.js</h4> <p>由于 <code>Next.js</code> 是动态服务，需要用 <code>Docker Node</code> 镜像，使用不了 <code>Nginx</code> 镜像。需要配置环境变量</p> <p>在 Docker 容器会注入环境变量， Next 项目可以获取到这个环境变量</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 配置前缀路径</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">basePath</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">BASE_URL</span> <span class="token operator">||</span> <span class="token string">'http://xxx.com'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>在本地开发时，如果直接调用测试环境，会存在跨域问题，使用 <code>Next.js</code> ，推荐使用中间的 <code>Node</code> 层，即在请求路径加上 <code>/api</code> 前缀，<code>Next.js</code> 会自动通过 <code>Node</code> 发送请求。就不会存在跨域问题。</p> <p>例如 <code>/api</code> 目录下的一个 <code>demo</code>：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> NextApiRequest<span class="token punctuation">,</span> NextApiResponse <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'next'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> fetcher <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'utils/index'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">handler</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>req<span class="token operator">:</span> NextApiRequest<span class="token punctuation">,</span> res<span class="token operator">:</span> NextApiResponse<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> method<span class="token punctuation">,</span> body <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> token<span class="token punctuation">,</span> siteuid <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token operator">?.</span>headers<span class="token punctuation">;</span>
  <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
    method<span class="token punctuation">,</span>
    body<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token comment">// ... 处理参数</span>
  <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetcher</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> handler<span class="token punctuation">;</span>
</code></pre></div><h4 id="封装-fetch"><a href="#封装-fetch" class="header-anchor">#</a> 封装 fetch</h4> <ul><li>对权限报错统一处理，并允许跳过报错处理</li> <li>客户端/Node层 通用</li> <li>支持 <code>mock</code> <code>api</code> <code>http</code> 等调用方式</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">const</span> <span class="token function-variable function">getEnv</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token literal-property property">publicRuntimeConfig</span><span class="token operator">:</span> env <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">getConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> env <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// fetch 函数</span>
<span class="token keyword">const</span> fetcher <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>url<span class="token punctuation">,</span> options<span class="token punctuation">,</span> proxy <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> url <span class="token operator">!==</span> <span class="token string">'string'</span><span class="token punctuation">)</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">'url must be required and of string type'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> env <span class="token operator">=</span> <span class="token function">getEnv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> isClient <span class="token operator">=</span> <span class="token keyword">typeof</span> window <span class="token operator">!==</span> <span class="token string">'undefined'</span><span class="token punctuation">;</span>

  <span class="token comment">// ...</span>

  <span class="token comment">//  不同环境区分不同的 请求路径 地址</span>
  <span class="token keyword">let</span> targetUrl<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>mock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    targetUrl <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>env<span class="token punctuation">.</span><span class="token constant">MOCK_URL</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>parseUrl<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'/api'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isClient<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    targetUrl <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>env<span class="token punctuation">.</span><span class="token constant">BASE_URL</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>parseUrl<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>url<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    targetUrl <span class="token operator">=</span> url<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>parseUrl<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'/api/'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    targetUrl <span class="token operator">=</span> parseUrl<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span>targetUrl<span class="token punctuation">,</span> newOptions<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 是否跳过 token失效跳转 等 错误处理。例如获取用户信息接口</span>
      <span class="token keyword">const</span> skipErrorHandler <span class="token operator">=</span> newOptions<span class="token operator">?.</span>skipErrorHandler<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>skipErrorHandler<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> res<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// token expired/forbidden</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>isClient <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>res<span class="token operator">?.</span>code <span class="token operator">===</span> <span class="token string">'100002'</span> <span class="token operator">||</span> res<span class="token operator">?.</span>code <span class="token operator">===</span> <span class="token string">'100003'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/login?redirect=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>window<span class="token operator">?.</span>location<span class="token operator">?.</span>href<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">updateUserInfo</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">login</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> res<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// 其他报错</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>
        isClient <span class="token operator">&amp;&amp;</span>
        <span class="token operator">!</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span>res<span class="token operator">?.</span>code<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'0'</span> <span class="token operator">||</span> <span class="token function">String</span><span class="token punctuation">(</span>res<span class="token operator">?.</span>status<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'0'</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Toast<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span>res<span class="token operator">?.</span>code<span class="token punctuation">)</span> <span class="token operator">||</span> res<span class="token operator">?.</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> res<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> res<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'fetch error: '</span><span class="token punctuation">,</span> targetUrl<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="其他技术栈"><a href="#其他技术栈" class="header-anchor">#</a> 其他技术栈</h2> <h3 id="接入极验与风控"><a href="#接入极验与风控" class="header-anchor">#</a> 接入极验与风控</h3> <p>极验验证是一种在计算机领域用于区分自然人和机器人的，通过简单集成的方式，为开发者提供安全、便捷的云端验证服务。</p> <p>前端主要做的事情是，引入极验实例，并且初始化实例。</p> <ul><li>页面上对按钮做了透明处理，用户点击极验按钮的时候，无感知。</li> <li>在每次点击完极验按钮之后，需要手动 <code>destroy</code> 极验实例，并且重新初始化极验实例</li> <li>传给极验初始化的 Login 函数，不能够获取到最新的 state，需要把要传递的数据记录在 ref 上面进行动态更新</li> <li>触发风险二次校验，需要配置 bind 模式，并且手动调用 gtInstance.click，这样验证图片可以直接弹出</li></ul> <h3 id="埋点"><a href="#埋点" class="header-anchor">#</a> 埋点</h3> <p>一种是曝光/点击埋点</p> <p>还有一种是报错埋点，通过 React 的 ErrorBounding、componentDidCatch</p> <h3 id="国际化"><a href="#国际化" class="header-anchor">#</a> 国际化</h3> <p>国家化需要使用 <code>getStaticProps</code> api 生成 翻译文件，并传递给页面级组件。</p> <h4 id="redux"><a href="#redux" class="header-anchor">#</a> redux</h4> <p>如何在使用 updateState 的时候，进行友好提示，即提示更新的属性</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createSlice<span class="token punctuation">,</span> SliceCaseReducers <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@reduxjs/toolkit'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'./root-store'</span><span class="token punctuation">;</span>

<span class="token keyword">interface</span> <span class="token class-name">State</span> <span class="token punctuation">{</span>
  <span class="token comment">/** 登录状态 */</span>
  login<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">type</span> <span class="token class-name">UserState</span> <span class="token operator">=</span> Partial<span class="token operator">&lt;</span>State<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token comment">// 此处需要给 SliceCaseReducers 传递泛型</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> userStore <span class="token operator">=</span> <span class="token generic-function"><span class="token function">createSlice</span><span class="token generic class-name"><span class="token operator">&lt;</span>UserState<span class="token punctuation">,</span> SliceCaseReducers<span class="token operator">&lt;</span>UserState<span class="token operator">&gt;&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'user'</span><span class="token punctuation">,</span>
  initialState<span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  reducers<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">updateUserInfo</span><span class="token operator">:</span> <span class="token punctuation">(</span>state<span class="token operator">:</span> UserState<span class="token punctuation">,</span> action<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> <span class="token operator">...</span>action<span class="token punctuation">.</span>payload <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> updateUserInfo <span class="token punctuation">}</span> <span class="token operator">=</span> userStore<span class="token punctuation">.</span>actions<span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">updateUserState</span> <span class="token operator">=</span> <span class="token punctuation">(</span>state<span class="token operator">:</span> UserState<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">updateUserInfo</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> userStore<span class="token punctuation">.</span>reducer<span class="token punctuation">;</span>
</code></pre></div><h3 id="swiper插件"><a href="#swiper插件" class="header-anchor">#</a> Swiper插件</h3></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">LastEditTime:</span> <span class="time">2023/4/9 16:56:44</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/system/http.html" class="prev">
        http 知识体系
      </a></span> <span class="next"><a href="/blog/engineering/webpack-react.html">
        使用 webpack 从零配置 React 开发环境及打包优化
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><div id="live2d-widget" class="live2d-widget-container" style="position:fixed;right:30px;bottom:30px;width:135px;height:300px;z-index:99999;opacity:0.8;pointer-events:none;"><canvas id="live2d_canvas" width="135" height="300" class="live2d_canvas" style="position:absolute;left:0px;top:0px;width:135px;height:300px;"></canvas></div></div></div>
    <script src="/blog/assets/js/app.ca54a27b.js" defer></script><script src="/blog/assets/js/2.16787ae8.js" defer></script><script src="/blog/assets/js/49.56b4130b.js" defer></script>
  </body>
</html>
