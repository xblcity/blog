(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{553:function(t,s,a){"use strict";a.r(s);var e=a(48),r=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"博客的后端实现"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#博客的后端实现"}},[t._v("#")]),t._v(" 博客的后端实现")]),t._v(" "),a("p",[t._v("这里算是留的一个坑把，后面有时间给补上...")]),t._v(" "),a("h2",{attrs:{id:"使用koa2与typeorm"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用koa2与typeorm"}},[t._v("#")]),t._v(" 使用Koa2与TypeORM")]),t._v(" "),a("p",[t._v("使用"),a("code",[t._v("Node.js")]),t._v("框架"),a("code",[t._v("Koa2")]),t._v("与"),a("code",[t._v("TypeORM")]),t._v("操作数据库，更为简单的实现博客后端功能")]),t._v(" "),a("p",[t._v("项目使用了"),a("code",[t._v("TypeScript")])]),t._v(" "),a("h3",{attrs:{id:"mysql数据库需要的表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql数据库需要的表"}},[t._v("#")]),t._v(" mysql数据库需要的表")]),t._v(" "),a("ul",[a("li",[t._v("user 用户")]),t._v(" "),a("li",[t._v("article 文章")]),t._v(" "),a("li",[t._v("comment 评论")]),t._v(" "),a("li",[t._v("reply 回复")]),t._v(" "),a("li",[t._v("tag 标签，每个标签对应不同的文章列表")])]),t._v(" "),a("p",[t._v("具体的表见"),a("a",{attrs:{href:""}},[t._v("这里")])]),t._v(" "),a("p",[t._v("表的关联处理比较麻烦，这里以user为例")]),t._v(" "),a("div",{staticClass:"language-ts extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ts"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// user.d.ts")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Item")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IBase")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Item "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  id"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("number")]),t._v("\n  username"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("\n  password"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("\n  auth"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n  comments"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" IComment"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Item"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// comment要符合IComment命名空间Item的类型")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// user.ts entity")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("Entity"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" PrimaryGeneratedColumn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Column"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" OneToMany"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'typeorm'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("Comment"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./Comment'")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token decorator"}},[a("span",{pre:!0,attrs:{class:"token at operator"}},[t._v("@")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Entity")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("User")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("implements")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IUser")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Item "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token decorator"}},[a("span",{pre:!0,attrs:{class:"token at operator"}},[t._v("@")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("PrimaryGeneratedColumn")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  id"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("number")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token decorator"}},[a("span",{pre:!0,attrs:{class:"token at operator"}},[t._v("@")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Column")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" type"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'varchar'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" length"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  username"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token decorator"}},[a("span",{pre:!0,attrs:{class:"token at operator"}},[t._v("@")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Column")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" type"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'varchar'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" length"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("255")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  password"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token decorator"}},[a("span",{pre:!0,attrs:{class:"token at operator"}},[t._v("@")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Column")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" type"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'tinyint'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" length"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  auth"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token decorator"}},[a("span",{pre:!0,attrs:{class:"token at operator"}},[t._v("@")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("OneToMany")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" Comment"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 一个user对应多个Comment")]),t._v("\n    comment "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" comment"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("user "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 一个comment对应一个user")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  comments"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Comment"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// comments类型要符合Comment entity")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" User\n")])])]),a("h3",{attrs:{id:"路由"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#路由"}},[t._v("#")]),t._v(" 路由")]),t._v(" "),a("h4",{attrs:{id:"登录-注册"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#登录-注册"}},[t._v("#")]),t._v(" 登录/注册")]),t._v(" "),a("ul",[a("li",[t._v("/api/register")]),t._v(" "),a("li",[t._v("/api/login")])]),t._v(" "),a("h4",{attrs:{id:"用户"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#用户"}},[t._v("#")]),t._v(" 用户")]),t._v(" "),a("ul",[a("li",[t._v("/api/user/list 用户列表")]),t._v(" "),a("li",[t._v("/api/user/delete 删除某一用户")])]),t._v(" "),a("h4",{attrs:{id:"文章"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#文章"}},[t._v("#")]),t._v(" 文章")]),t._v(" "),a("ul",[a("li",[t._v("/api/article/create  创建文章")]),t._v(" "),a("li",[t._v("/api/article/list 文章列表")]),t._v(" "),a("li",[t._v("/api/article/detail 文章详情")]),t._v(" "),a("li",[t._v("/api/article/delete 删除文章")]),t._v(" "),a("li",[t._v("/api/article/update 更新文章")])]),t._v(" "),a("h4",{attrs:{id:"标签"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#标签"}},[t._v("#")]),t._v(" 标签")]),t._v(" "),a("ul",[a("li",[t._v("/api/tag/list 标签对应文章列表")])]),t._v(" "),a("h4",{attrs:{id:"评论与回复"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#评论与回复"}},[t._v("#")]),t._v(" 评论与回复")]),t._v(" "),a("ul",[a("li",[t._v("/api/discuss/publish 发布评论")]),t._v(" "),a("li",[t._v("/api/discuss/delete 删除评论")]),t._v(" "),a("li",[t._v("/api/discuss/reply 回复评论")]),t._v(" "),a("li",[t._v("/api/discuss/reply/delete 删除回复评论")])]),t._v(" "),a("p",[t._v("具体的路由见"),a("a",{attrs:{href:""}},[t._v("这里")])]),t._v(" "),a("h3",{attrs:{id:"controller处理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#controller处理"}},[t._v("#")]),t._v(" controller处理")]),t._v(" "),a("p",[t._v("根据路由进行控制层的书写")]),t._v(" "),a("p",[t._v("controller层，处理逻辑相关")]),t._v(" "),a("p",[t._v("一般先处理错误情况并抛出")]),t._v(" "),a("h4",{attrs:{id:"user"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#user"}},[t._v("#")]),t._v(" user")]),t._v(" "),a("p",[t._v("在user把通用的引入包的作用以及通用api都进行了注释，"),a("a",{attrs:{href:""}},[t._v("点击这里进行查看")])]),t._v(" "),a("h4",{attrs:{id:"article"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#article"}},[t._v("#")]),t._v(" article")]),t._v(" "),a("h4",{attrs:{id:"tag"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#tag"}},[t._v("#")]),t._v(" tag")]),t._v(" "),a("h4",{attrs:{id:"comment"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#comment"}},[t._v("#")]),t._v(" comment")]),t._v(" "),a("h4",{attrs:{id:"reply"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#reply"}},[t._v("#")]),t._v(" reply")]),t._v(" "),a("p",[a("strong",[t._v("待更新...")])]),t._v(" "),a("h2",{attrs:{id:"原生node-js"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#原生node-js"}},[t._v("#")]),t._v(" 原生node.js")]),t._v(" "),a("p",[t._v("注意事项")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("访问日志记录")])]),t._v(" "),a("li",[a("p",[t._v("设置返回数据类型，"),a("code",[t._v("res.setHeader('Content-Type', 'application/json')")])])]),t._v(" "),a("li",[a("p",[t._v("路径pathname解析，query参数解析，cookie解析/session解析，post请求body请求体数据的解析。。解析之后的解决分别挂载到"),a("code",[t._v("req.path, req.query, req.cookie/req.sessionId, req.body")])])]),t._v(" "),a("li",[a("p",[t._v("上述操作完成后，处理路由，如果请求的"),a("code",[t._v("pathname")]),t._v("是"),a("code",[t._v("blog")]),t._v("相关的路径，则由"),a("code",[t._v("blog")]),t._v("路由处理，如果请求的"),a("code",[t._v("pathname")]),t._v("是"),a("code",[t._v("user")]),t._v("相关的路径，则由"),a("code",[t._v("user")]),t._v("路由处理")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("user")]),t._v("相关操作，即登录，登录成功，需要用"),a("code",[t._v("redis")]),t._v("设置"),a("code",[t._v("session")])])]),t._v(" "),a("li",[a("p",[a("code",[t._v("blog")]),t._v("相关操作(这里没有使用Restful Api)：获取博客列表(get)，获取博客详情(get)，新建博客(post)，更新博客(post)，删除博客(post)")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("post")]),t._v("请求校验"),a("code",[t._v("session")]),t._v("，即登录状态，校验成功返回数据，不成功抛错")])]),t._v(" "),a("li",[a("p",[t._v("对于"),a("code",[t._v("redis")]),t._v("以及"),a("code",[t._v("MySQL")]),t._v("的取值操作都要由对应的错误处理")])]),t._v(" "),a("li",[a("p",[t._v("在路由中涉及数据库操作写在"),a("code",[t._v("controller")]),t._v("里面以供调用")])]),t._v(" "),a("li",[a("p",[t._v("对于内容部分，使用"),a("code",[t._v("xss")]),t._v("模块对内容进行转义")])])]),t._v(" "),a("p",[a("strong",[t._v("待更新...")])])])}),[],!1,null,null,null);s.default=r.exports}}]);